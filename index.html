<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <title>GodGoodFood</title>
<link href="style.css" rel="stylesheet">
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body>
  		<script src="http://mrdoob.github.com/three.js/build/three.min.js"></script>
  		<script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>
          <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
		<div id="icons" onClick="hideImage()">
  			  <img class= "food-icon" src="../GodGoodFood/foodIcons/buger.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/chiken.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/curasan.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/hotdog.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/icecream.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/pizza.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/poncik.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/potato.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/sandwitch.jpg" />
			  <img class= "food-icon" src="../GodGoodFood/foodIcons/shava.jpg" />
</div>
  <b class ="place-to-eat">Вот сюда сходи</b>
  <script type="text/javascript">
		var xhr = new XMLHttpRequest();
		var url = "http://f5270838.ngrok.io";
		var lat = "";
		var lon = "";
		var isRequestSending = false;
						
				
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showPosition);
		} else { 
			x.innerHTML = "Geolocation is not supported by this browser.";
		}		
				
		function showPosition(position) {
				lat = position.coords.latitude
				lon = position.coords.longitude
				console.log("Попал")
			}
				
		function sendLocationRequest(){
				xhr.open("POST", url, true);
		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhr.onreadystatechange = function () {
			if (xhr.readyState === 4 && xhr.status === 200) {
				
				//var json = JSON.parse(xhr.responseText);
				//console.log(json.lat + ", " + json.lon); //Ответ от .py
				console.log(xhr.responseText)
			}
		}
		
		var data = JSON.stringify({"lat": lat, "lon": lon});
		console.log(data)
		xhr.send(data);
		}
	
	  $( function() {
    $( "#slider-range" ).slider({
      range: true,
      min: 0,
      max: 2000,
      values: [ 200, 1000 ],
      slide: function( event, ui ) {
        $( "#amount" ).val(ui.values[ 0 ]+ "р" + " - " + ui.values[ 1 ] + "р");
      }
    });
    $( "#amount" ).val( $( "#slider-range" ).slider( "values", 0 ) + "р" +
      " - " + $( "#slider-range" ).slider( "values", 1 ) + "р" );
  } );
	  
   $( ".place-to-eat" ).fadeOut(0);
  var now = new Date().getTime();
  var currentImageIndex = 9;
  var repeatCounter = 0;
  
  var arrayOfImages = document.getElementsByClassName("food-icon");
        
    function hideImage(){
	  if (!isRequestSending){
	  sendLocationRequest()
	  };
      arrayOfImages[currentImageIndex].style.visibility = "hidden";
      if (currentImageIndex > 0) {
        currentImageIndex -= 1;
		isRequestSending = true;

        if (currentImageIndex == 1 && repeatCounter < 3) {
          repeatCounter ++;
          makeAllImagesVisible()
          currentImageIndex = 9;
          setTimeout(hideImage, 100);
          return;
        } else {
          setTimeout(hideImage, 100);
        }
        
      } else {
        currentImageIndex = 9;
        makeAllImagesVisible();
        rotateAndFadeOut();
		isRequestSending = false;
      }
    }
    
    function makeAllImagesVisible() {
      Array.from(arrayOfImages).forEach(function(element) {
        element.style.visibility = "visible";
        });
    }
    
    
    function rotateAndFadeOut() {
      $( "#icons" ).fadeOut(1000);
      $(".place-to-eat").fadeIn(1500);
      arrayOfImages[currentImageIndex].style.boxShadow = "0px 0px 10px 40px rgba(230,245,255,0.3)";
      document.getElementById("icons").style.transform = "rotateY(180deg)";

    }
    
  </script>
  
  <p>
  <label class = "priceRange" for="amount">Выбери сумму:</label>
  <input  class = "priceRange" type="text" id="amount" readonly >
</p>
 
<div id="slider-range"></div>

  
  <script type="text/javascript">
    
    //    var x = document.getElementById("lat");
//    var y = document.getElementById("lon");

//    if (navigator.geolocation) {
//      navigator.geolocation.getCurrentPosition(showPosition);
//    } else {
//      x.innerHTML = "Geolocation is not supported by this browser.";
//    }
//
//    function showPosition(position) {
//      x.innerHTML = position.coords.latitude;
//      y.innerHTML = position.coords.longitude;
//    }
  </script>
</body>

</html>



